function WebsocketPlayer(a,b){this.videoPlayer;this.audioPlayer;this.videoCanvasCtx=b;this.videoCanvas=a;this.incomingAudioBuffer=[];this.incomingVideoBuffer=[];this.tsVideoWaitingList=[];this.audioSSRC="";this.videoSSRC="";this.lastVideoTimestamp=0;this.lastAudioTimestamp=0;this.firstAudioTimestamp=0;this.firstVideoTimestamp=0;this.videoTimeDifference=0;this.audioTimeDifference=0;this.videoStarted=false;this.sync=false;this.bufferFilled=false;this.audioBufferWaitFor=1000}var requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}})();WebsocketPlayer.prototype.init=function(c){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;var b=new AudioContext();this.audioPlayer=new AudioPlayer(b,c.incomingAudioBufferLength)}catch(a){alert("Failed to init audio player"+a)}try{this.videoPlayer=new jsmpeg(null,{canvas:this.videoCanvas,forceCanvas2D:true,ondecodeframe:this.videoDecodedCallback.bind(this)});this.videoPlayer.initSocketClient(null,c.videoWidth,c.videoHeight)}catch(a){alert("Failed to init video player"+a)}};WebsocketPlayer.prototype.videoDecodedCallback=function(d,e){var b=this.tsVideoWaitingList.shift();var c=this.videoCanvasCtx.createImageData(e.width,e.height);c.data.set(new Uint8Array(e.data.buffer));var a={};a.timestamp=b;a.data=c;this.incomingVideoBuffer.push(a)};WebsocketPlayer.prototype.requestVideoFrameCallback=function(c){var a=this.getAudioPlayerTime();var b=this.incomingVideoBuffer[0];if(b!=undefined&&this.toCommonTimeBase(false,b.timestamp)<=a){this.videoCanvasCtx.putImageData(this.incomingVideoBuffer.shift().data,0,0)}if(this.videoStarted){requestAnimFrame(this.requestVideoFrameCallback.bind(this),this.videoCanvas)}};WebsocketPlayer.prototype.onDataReceived=function(b){var i=new DataView(b.data);var h={};var c=1;var e=i.getUint8(0);var d=e>>2&3;var a=e>>1&1;var f=e&1;if(d==1){if(a==1){this.videoSSRC=i.getUint32(c);c+=4}if(f==1){var g=i.getUint32(c);c+=4;if(this.firstVideoTimestamp==0){this.firstVideoTimestamp=g}if(this.lastVideoTimestamp!=g){this.tsVideoWaitingList.push(g)}this.lastVideoTimestamp=g}this.handleVideo(this.stripBytes(new Uint8Array(b.data),c))}else{if(d==2){if(a==1){this.audioSSRC=i.getUint32(c);c+=4}if(f==1){this.lastAudioTimestamp=i.getUint32(c);c+=4}if(this.firstAudioTimestamp==0){this.firstAudioTimestamp=this.lastAudioTimestamp}if(!this.bufferFilled){h.timestamp=this.lastAudioTimestamp;h.data=this.stripBytes(new Uint8Array(b.data),c);this.incomingAudioBuffer.push(h);if(this.audioBufferWaitFor<=this.incomingAudioBuffer.length*20){this.bufferFilled=true}}else{if(this.sync&&this.incomingAudioBuffer.length>0){console.log("Flush buffer, buffer size "+this.incomingAudioBuffer.length);console.log("time before flush, player "+this.getAudioPlayerTime()+" now "+this.audioPlayer.now());while(this.incomingAudioBuffer.length!=0){this.handleAudio(this.incomingAudioBuffer.shift().data)}this.handleAudio(this.stripBytes(new Uint8Array(b.data),c));console.log("time after flush, player "+this.getAudioPlayerTime()+" now "+this.audioPlayer.now());console.log("Common timebase ms audio "+this.toCommonTimeBase(true,this.firstAudioTimestamp)+" video "+this.toCommonTimeBase(false,this.lastVideoTimestamp));console.log("Common timebase difference "+(this.toCommonTimeBase(false,this.lastVideoTimestamp)-this.toCommonTimeBase(true,this.firstAudioTimestamp)));if(!this.videoStarted){this.videoStarted=true;requestAnimFrame(this.requestVideoFrameCallback.bind(this),this.videoCanvas)}}else{if(this.sync){this.handleAudio(this.stripBytes(new Uint8Array(b.data),c))}else{h.timestamp=this.lastAudioTimestamp;h.data=this.stripBytes(new Uint8Array(b.data),c);this.incomingAudioBuffer.push(h)}}}}else{if(d==3){this.handleRtcp(this.stripBytes(new Uint8Array(b.data),c))}else{console.log("Unknown binary data received, type "+d)}}}};WebsocketPlayer.prototype.handleVideo=function(a){this.videoPlayer.receiveSocketMessage(a)};WebsocketPlayer.prototype.handleAudio=function(a){this.audioPlayer.ulaw8000(a)};WebsocketPlayer.prototype.handleRtcp=function(c){console.log("received rtcp");console.log("audio ssrc "+this.audioSSRC);console.log("video ssrc "+this.videoSSRC);var a=new DataView(c.buffer);console.log("RTCP SSRC "+a.getInt32(0));console.log("Timestamp "+a.getUint32(4));console.log("Time seconds "+a.getUint32(8));console.log("Time fraction of second "+a.getUint32(12));console.log("---------------------------------------------------");var d;var b;if(this.audioSSRC==a.getInt32(0)){d=a.getUint32(8)*1000+this.ntpFractionToMilliseconds(a.getUint32(12));b=this.tsToMilliseconds(a.getUint32(4),8000);this.audioTimeDifference=d-b;console.log("Audio difference "+this.audioTimeDifference+" ntpTimeMS "+d+" tsTimeMs "+b)}else{if(this.videoSSRC==a.getInt32(0)){d=a.getUint32(8)*1000+this.ntpFractionToMilliseconds(a.getUint32(12));b=this.tsToMilliseconds(a.getUint32(4),90000);this.videoTimeDifference=d-b;console.log("Video difference "+this.videoTimeDifference+" ntpTimeMS "+d+" tsTimeMs "+b)}else{console.log("Received rtcp with unknown ssrc!")}}if(this.audioTimeDifference!=0&&this.videoTimeDifference!=0){this.sync=true}};WebsocketPlayer.prototype.stop=function(){this.audioPlayer.stop();this.videoPlayer.stop();this.videoStarted=false};WebsocketPlayer.prototype.stripBytes=function(d,c){var a=new Uint8Array(d.byteLength-c);for(var b=0;b<a.byteLength;b++,c++){a[b]=d[c]}return a};WebsocketPlayer.prototype.ntpFractionToMilliseconds=function(a){return a*1000/4294967296};WebsocketPlayer.prototype.tsToMilliseconds=function(b,a){return b/a*1000};WebsocketPlayer.prototype.toCommonTimeBase=function(d,b){var a=d?8000:90000;var c=d?this.audioTimeDifference:this.videoTimeDifference;return this.tsToMilliseconds(b,a)+c};WebsocketPlayer.prototype.getAudioPlayerTime=function(){return this.audioPlayer.getCurrentPlayingTime()+this.toCommonTimeBase(true,this.firstAudioTimestamp)};function AudioPlayer(d,a){var b=this;this.initBuffers();this.nodeConnected=false;this.context=d;this.resampler=new Resampler(8000,44100,1,4096,true);this.lastBufferTime=0;this.timePlaying=0;this.internalBufferSize=parseInt(a)||2048;try{this.context.createScriptProcessor=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.audioJSNode=this.context.createScriptProcessor(this.internalBufferSize,1,1)}catch(c){alert("JS Audio Node is not supported in this browser"+c)}this.audioJSNode.onaudioprocess=function(j){var k=b.internalBufferSize;var f;var e;var h;if(b.decodedBufferPos>=k){f=b.shiftDecodedData(k);e=j.outputBuffer.getChannelData(0);for(h=0;h<e.length;h++){e[h]=f[h]}if(b.lastBufferTime==0){console.log("Audio Player, playing first buffer!");b.lastBufferTime=b.now()}else{b.lastBufferTime=b.now();b.timePlaying+=k/44100*1000}}else{var g=k-b.decodedBufferPos;console.log("Not enough data in audio buffer! Playing silence samples, size "+g);f=b.shiftDecodedData(b.decodedBufferPos);e=j.outputBuffer.getChannelData(0);for(h=0;h<f.length;h++){e[h]=f[h]}for(;h<e.length;h++){e[h]=0}b.lastBufferTime=b.now();b.timePlaying+=k/44100*1000}};this.codec=new G711U();console.log("AudioPlayer ready, incoming buffer length "+this.internalBufferSize)}AudioPlayer.prototype.initBuffers=function(){this.decodedBufferSize=705600;this.decodedBufferArray=new ArrayBuffer(this.decodedBufferSize);this.decodedBufferView=new Float32Array(this.decodedBufferArray);for(var a=0;a<this.decodedBufferView.length;a++){this.decodedBufferView[a]=0}this.decodedBufferPos=0;console.log("Buffers ready")};AudioPlayer.prototype.ulaw8000=function(f){var a=this.codec.decode(f);var b=new Float32Array(a.byteLength/2);var g=new DataView(a.buffer);for(var d=0;d<b.length;d++){b[d]=g.getInt16(d*2,true)/32768}var c=this.resampler.resampler(b);var e=this.resampler.outputBuffer.subarray(0,c);this.pushDecodedData(e);if(!this.nodeConnected&&this.decodedBufferPos>this.internalBufferSize){this.audioJSNode.connect(this.context.destination);this.nodeConnected=true}};AudioPlayer.prototype.play16PCM8000=function(e){var a=new Float32Array(e.byteLength/2);var f=new DataView(e.buffer);for(var c=0;c<a.length;c++){a[c]=f.getInt16(c*2,true)/32768}var b=this.resampler.resampler(a);var d=this.resampler.outputBuffer.subarray(0,b);this.pushDecodedData(d);this.incomingBufferPos=0;if(!this.nodeConnected&&this.decodedBufferPos>this.internalBufferSize){this.audioJSNode.connect(this.context.destination);this.nodeConnected=true}};AudioPlayer.prototype.play32PCM8000=function(e){var a=new Float32Array(e.byteLength/4);var f=new DataView(e.buffer);for(var c=0;c<a.length;c++){a[c]=f.getFloat32(c*4,true)}var b=me.resampler.resampler(a);var d=me.resampler.outputBuffer.subarray(0,b);this.pushDecodedData(d);if(!me.nodeConnected&&this.decodedBufferPos>this.internalBufferSize){me.audioJSNode.connect(me.context.destination);me.nodeConnected=true}};AudioPlayer.prototype.play32PCM44100=function(c){var a=new Float32Array(c.byteLength/4);var d=new DataView(c.buffer);for(var b=0;b<a.length;b++){a[b]=d.getFloat32(b*4,true)}this.pushDecodedData(a);if(!me.nodeConnected&&this.decodedBufferPos>this.internalBufferSize){me.audioJSNode.connect(me.context.destination);me.nodeConnected=true}};AudioPlayer.prototype.stop=function(){this.audioJSNode.disconnect()};AudioPlayer.prototype.getCurrentPlayingTime=function(){if(this.lastBufferTime!=0){return this.timePlaying+(this.now()-this.lastBufferTime)}else{return 0}};AudioPlayer.prototype.pushDecodedData=function(d){var b;if(this.decodedBufferSize/4-this.decodedBufferPos>d.length){for(b=0;b<d.length;b++){this.decodedBufferView[this.decodedBufferPos++]=d[b]}}else{console.log("ERROR Decoded audio buffer full, shift data and time. This can result in audio glitch");var c=this.decodedBufferSize/4-this.decodedBufferPos;var a=d.length-c;this.shiftDecodedData(a);for(b=0;b<d.length;b++){this.decodedBufferView[this.decodedBufferPos++]=d[b]}this.timePlaying+=a/44100*1000}};AudioPlayer.prototype.shiftDecodedData=function(c){var a=new Float32Array(c);var b;for(b=0;b<c;b++){a[b]=this.decodedBufferView[b]}var d=this.decodedBufferPos;for(b=0;b<d-c;b++){this.decodedBufferView[b]=this.decodedBufferView[b+c]}this.decodedBufferPos=d-c;return a};AudioPlayer.prototype.now=function(){return window.performance?window.performance.now():Date.now()};var G711U=window.G711U=function(){this.SIGN_BIT=128;this.BIAS=132;this.SEG_SHIFT=4;this.QUANT_MASK=15;this.SEG_MASK=112};G711U.prototype.decode=function(c){var d=c;var a=new Uint8Array(c.length*2);for(index=0;index<d.length;++index){var b=this.ulaw2linear(d[index]);var e=index<<1;a[e]=(b&255);a[++e]=(b&65280)>>>8}return a};G711U.prototype.ulaw2linear=function(b){var a;b=~b;a=((b&this.QUANT_MASK)<<3)+this.BIAS;a<<=(b&this.SEG_MASK)>>this.SEG_SHIFT;return((b&this.SIGN_BIT)!=0?(this.BIAS-a):(a-this.BIAS))};G711U.prototype.getWavHeader=function(){return this.parseHex("524946466406000057415645666d74201000000001000100401f0000803e0000020010006461746140060000")};G711U.prototype.printWavHeader=function(c){var a=new DataView(this.parseHex(c).buffer);var b=0;console.log("RIFF "+a.getInt32(b));b+=4;console.log("Chunk size:"+a.getInt32(b,true));b+=4;console.log("Format:"+a.getInt32(b));b+=4;console.log("Subchunk id:"+a.getInt32(b));b+=4;console.log("Subchunk size:"+a.getInt32(b,true));b+=4;console.log("AudioFormat:"+a.getInt16(b,true));b+=2;console.log("NumChannels:"+a.getUint16(b,true));b+=2;console.log("Sample rate:"+a.getInt32(b,true));b+=4;console.log("Byte rate:"+a.getInt32(b,true))};G711U.prototype.parseHex=function(c){var a=[];for(var b=0;b<c.length;b+=2){a.push(parseInt("0x"+c.substr(b,2),16))}return new Uint8Array(a)};G711U.prototype.byteToHex=function(a){var c=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return c[(a>>4)&15]+c[a&15]};G711U.prototype.printArrayAsHex=function(d){var e="";var c="";for(var b=0;b<d.byteLength;b++){var a=this.byteToHex(d[b]);e+=a;c+=a;if(b%32==0){c+="\n"}}console.log(e);console.log(c)};(function(p){var k=(function(){return p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||function(I){p.setTimeout(I,1000/60)}})();var n=p.jsmpeg=function(I,J){J=J||{};this.benchmark=!!J.benchmark;this.canvas=J.canvas||document.createElement("canvas");this.autoplay=!!J.autoplay;this.loop=!!J.loop;this.externalLoadCallback=J.onload||null;this.externalDecodeCallback=J.ondecodeframe||null;this.externalFinishedCallback=J.onfinished||null;this.customIntraQuantMatrix=new Uint8Array(64);this.customNonIntraQuantMatrix=new Uint8Array(64);this.blockData=new Int32Array(64);this.zeroBlockData=new Int32Array(64);this.fillArray(this.zeroBlockData,0);if(!J.forceCanvas2D&&this.initWebGL()){this.renderFrame=this.renderFrameGL}else{this.canvasContext=this.canvas.getContext("2d");this.renderFrame=this.renderFrame2D}};n.prototype.waitForIntraFrame=true;n.prototype.socketBufferSize=512*1024;n.prototype.onlostconnection=null;n.prototype.initSocketClient=function(J,K,I){console.log("initSocketClient");this.buffer=new A(new ArrayBuffer(this.socketBufferSize));this.nextPictureBuffer=new A(new ArrayBuffer(this.socketBufferSize));this.nextPictureBuffer.writePos=0;this.nextPictureBuffer.chunkBegin=0;this.nextPictureBuffer.lastWriteBeforeWrap=0;this.width=parseInt(K);this.height=parseInt(I)};n.prototype.decodeSocketHeader=function(I){};n.prototype.receiveSocketMessage=function(N){var M=new Uint8Array(N);M=M.subarray(4);if(!this.sequenceStarted){this.initBuffers()}var O=this.buffer;var L=this.nextPictureBuffer;if(L.writePos+M.length>L.length){L.lastWriteBeforeWrap=L.writePos;L.writePos=0;L.index=0}L.bytes.set(M,L.writePos);L.writePos+=M.length;var J=0;while(true){J=L.findNextMPEGStartCode();if(J==A.NOT_FOUND||((L.index>>3)>L.writePos)){L.index=Math.max((L.writePos-3),0)<<3;return}else{if(J==t){break}}}if(this.waitForIntraFrame){L.advance(10);if(L.getBits(3)==h){this.waitForIntraFrame=false;L.chunkBegin=(L.index-13)>>3}return}if(!this.currentPictureDecoded){this.decodePicture()}var K=((L.index)>>3);if(K>L.chunkBegin){O.bytes.set(L.bytes.subarray(L.chunkBegin,K));O.writePos=K-L.chunkBegin}else{O.bytes.set(L.bytes.subarray(L.chunkBegin,L.lastWriteBeforeWrap));var I=L.lastWriteBeforeWrap-L.chunkBegin;O.bytes.set(L.bytes.subarray(0,K),I);O.writePos=K+I}O.index=0;L.chunkBegin=K;this.currentPictureDecoded=false;this.decodePicture()};n.prototype.scheduleDecoding=function(){this.decodePicture();this.currentPictureDecoded=true};n.prototype.isRecording=false;n.prototype.recorderWaitForIntraFrame=false;n.prototype.recordedFrames=0;n.prototype.recordedSize=0;n.prototype.didStartRecordingCallback=null;n.prototype.recordBuffers=[];n.prototype.canRecord=function(){return(this.client&&this.client.readyState==this.client.OPEN)};n.prototype.startRecording=function(L){if(!this.canRecord()){return}this.discardRecordBuffers();this.isRecording=true;this.recorderWaitForIntraFrame=true;this.didStartRecordingCallback=L||null;this.recordedFrames=0;this.recordedSize=0;var J=(this.width>>4),I=((this.width&15)<<4)|(this.height>>8),K=(this.height&255);this.recordBuffers.push(new Uint8Array([0,0,1,179,J,I,K,19,255,255,225,88,0,0,1,184,0,8,0,0,0,0,1,0]))};n.prototype.recordFrameFromCurrentBuffer=function(){if(!this.isRecording){return}if(this.recorderWaitForIntraFrame){if(this.pictureCodingType!=h){return}this.recorderWaitForIntraFrame=false;if(this.didStartRecordingCallback){this.didStartRecordingCallback(this)}}this.recordedFrames++;this.recordedSize+=this.buffer.writePos;this.recordBuffers.push(new Uint8Array(this.buffer.bytes.subarray(0,this.buffer.writePos)))};n.prototype.discardRecordBuffers=function(){this.recordBuffers=[];this.recordedFrames=0};n.prototype.stopRecording=function(){var I=new Blob(this.recordBuffers,{type:"video/mpeg"});this.discardRecordBuffers();this.isRecording=false;return I};n.prototype.load=function(I){this.url=I;var K=new XMLHttpRequest();var J=this;K.onreadystatechange=function(){if(K.readyState==K.DONE&&K.status==200){J.loadCallback(K.response)}};K.onprogress=this.gl?this.updateLoaderGL.bind(this):this.updateLoader2D.bind(this);K.open("GET",I);K.responseType="arraybuffer";K.send()};n.prototype.updateLoader2D=function(L){var M=L.loaded/L.total,J=this.canvas.width,K=this.canvas.height,I=this.canvasContext;I.fillStyle="#222";I.fillRect(0,0,J,K);I.fillStyle="#fff";I.fillRect(0,K-K*M,J,K*M)};n.prototype.updateLoaderGL=function(I){var J=this.gl;J.uniform1f(J.getUniformLocation(this.loadingProgram,"loaded"),(I.loaded/I.total));J.drawArrays(J.TRIANGLE_STRIP,0,4)};n.prototype.loadCallback=function(I){this.buffer=new A(I);this.findStartCode(u);this.firstSequenceHeader=this.buffer.index;this.decodeSequenceHeader();this.nextFrame();if(this.autoplay){this.play()}if(this.externalLoadCallback){this.externalLoadCallback(this)}};n.prototype.play=function(I){if(this.playing){return}this.targetTime=this.now();this.playing=true;this.scheduleNextFrame()};n.prototype.pause=function(I){this.playing=false};n.prototype.stop=function(I){if(this.buffer){this.buffer.index=this.firstSequenceHeader}this.playing=false;if(this.client){this.client.close();this.client=null}};n.prototype.readCode=function(J){var I=0;do{I=J[I+this.buffer.getBits(1)]}while(I>=0&&J[I]!=0);return J[I+2]};n.prototype.findStartCode=function(I){var J=0;while(true){J=this.buffer.findNextMPEGStartCode();if(J==I||J==A.NOT_FOUND){return J}}return A.NOT_FOUND};n.prototype.fillArray=function(I,L){for(var J=0,K=I.length;J<K;J++){I[J]=L}};n.prototype.cachedFrameCount=0;n.prototype.calculateFrameCount=function(){if(!this.buffer||this.cachedFrameCount){return this.cachedFrameCount}var I=this.buffer.index,J=0;this.buffer.index=0;while(this.findStartCode(t)!==A.NOT_FOUND){J++}this.buffer.index=I;this.cachedFrameCount=J;return J};n.prototype.calculateDuration=function(){return this.calculateFrameCount()*(1/this.pictureRate)};n.prototype.pictureRate=30;n.prototype.lateTime=0;n.prototype.firstSequenceHeader=0;n.prototype.targetTime=0;n.prototype.benchmark=false;n.prototype.benchFrame=0;n.prototype.benchDecodeTimes=0;n.prototype.benchAvgFrameTime=0;n.prototype.now=function(){return p.performance?p.performance.now():Date.now()};n.prototype.nextFrame=function(){if(!this.buffer){return}var J=this.now();while(true){var I=this.buffer.findNextMPEGStartCode();if(I==u){this.decodeSequenceHeader()}else{if(I==t){if(this.playing){this.scheduleNextFrame()}this.decodePicture();this.benchDecodeTimes+=this.now()-J;return this.canvas}else{if(I==A.NOT_FOUND){this.stop();if(this.externalFinishedCallback){this.externalFinishedCallback(this)}if(this.loop&&this.sequenceStarted){this.play()}return null}else{}}}}};n.prototype.scheduleNextFrame=function(){this.lateTime=this.now()-this.targetTime;var I=Math.max(0,(1000/this.pictureRate)-this.lateTime);this.targetTime=this.now()+I;if(this.benchmark){this.benchFrame++;if(this.benchFrame>=120){this.benchAvgFrameTime=this.benchDecodeTimes/this.benchFrame;this.benchFrame=0;this.benchDecodeTimes=0;if(p.console){console.log("Average time per frame:",this.benchAvgFrameTime,"ms")}}setTimeout(this.nextFrame.bind(this),0)}else{if(I<18){this.scheduleAnimation()}else{setTimeout(this.scheduleAnimation.bind(this),I)}}};n.prototype.scheduleAnimation=function(){k(this.nextFrame.bind(this),this.canvas)};n.prototype.decodeSequenceHeader=function(){this.width=this.buffer.getBits(12);this.height=this.buffer.getBits(12);this.buffer.advance(4);this.pictureRate=q[this.buffer.getBits(4)];this.buffer.advance(18+1+10+1);this.initBuffers();if(this.buffer.getBits(1)){for(var I=0;I<64;I++){this.customIntraQuantMatrix[G[I]]=this.buffer.getBits(8)}this.intraQuantMatrix=this.customIntraQuantMatrix}if(this.buffer.getBits(1)){for(var I=0;I<64;I++){this.customNonIntraQuantMatrix[G[I]]=this.buffer.getBits(8)}this.nonIntraQuantMatrix=this.customNonIntraQuantMatrix}};n.prototype.initBuffers=function(){this.intraQuantMatrix=F;this.nonIntraQuantMatrix=w;this.mbWidth=(this.width+15)>>4;this.mbHeight=(this.height+15)>>4;this.mbSize=this.mbWidth*this.mbHeight;this.codedWidth=this.mbWidth<<4;this.codedHeight=this.mbHeight<<4;this.codedSize=this.codedWidth*this.codedHeight;this.halfWidth=this.mbWidth<<3;this.halfHeight=this.mbHeight<<3;this.quarterSize=this.codedSize>>2;if(this.sequenceStarted){return}this.sequenceStarted=true;var I=p.Uint8ClampedArray||p.Uint8Array;if(!p.Uint8ClampedArray){this.copyBlockToDestination=this.copyBlockToDestinationClamp;this.addBlockToDestination=this.addBlockToDestinationClamp}this.currentY=new I(this.codedSize);this.currentY32=new Uint32Array(this.currentY.buffer);this.currentCr=new I(this.codedSize>>2);this.currentCr32=new Uint32Array(this.currentCr.buffer);this.currentCb=new I(this.codedSize>>2);this.currentCb32=new Uint32Array(this.currentCb.buffer);this.forwardY=new I(this.codedSize);this.forwardY32=new Uint32Array(this.forwardY.buffer);this.forwardCr=new I(this.codedSize>>2);this.forwardCr32=new Uint32Array(this.forwardCr.buffer);this.forwardCb=new I(this.codedSize>>2);this.forwardCb32=new Uint32Array(this.forwardCb.buffer);this.canvas.width=this.width;this.canvas.height=this.height;if(this.gl){this.gl.useProgram(this.program);this.gl.viewport(0,0,this.width,this.height)}else{this.currentRGBA=this.canvasContext.getImageData(0,0,this.width,this.height);this.fillArray(this.currentRGBA.data,255)}};n.prototype.currentY=null;n.prototype.currentCr=null;n.prototype.currentCb=null;n.prototype.currentRGBA=null;n.prototype.pictureCodingType=0;n.prototype.forwardY=null;n.prototype.forwardCr=null;n.prototype.forwardCb=null;n.prototype.fullPelForward=false;n.prototype.forwardFCode=0;n.prototype.forwardRSize=0;n.prototype.forwardF=0;n.prototype.decodePicture=function(K){this.buffer.advance(10);this.pictureCodingType=this.buffer.getBits(3);this.buffer.advance(16);if(this.pictureCodingType<=0||this.pictureCodingType>=m){return}if(this.pictureCodingType==a){this.fullPelForward=this.buffer.getBits(1);this.forwardFCode=this.buffer.getBits(3);if(this.forwardFCode==0){return}this.forwardRSize=this.forwardFCode-1;this.forwardF=1<<this.forwardRSize}var M=0;do{M=this.buffer.findNextMPEGStartCode()}while(M==c||M==z);while(M>=y&&M<=b){this.decodeSlice((M&255));M=this.buffer.findNextMPEGStartCode()}this.buffer.rewind(32);this.recordFrameFromCurrentBuffer();if(K!=D){this.renderFrame();if(this.externalDecodeCallback){this.externalDecodeCallback(this,this.currentRGBA)}}if(this.pictureCodingType==h||this.pictureCodingType==a){var P=this.forwardY,N=this.forwardY32,L=this.forwardCr,J=this.forwardCr32,I=this.forwardCb,O=this.forwardCb32;this.forwardY=this.currentY;this.forwardY32=this.currentY32;this.forwardCr=this.currentCr;this.forwardCr32=this.currentCr32;this.forwardCb=this.currentCb;this.forwardCb32=this.currentCb32;this.currentY=P;this.currentY32=N;this.currentCr=L;this.currentCr32=J;this.currentCb=I;this.currentCb32=O}};n.prototype.YCbCrToRGBA=function(){var M=this.currentY;var ac=this.currentCb;var Q=this.currentCr;var ad=this.currentRGBA.data;var S=0;var R=this.codedWidth;var af=this.codedWidth+(this.codedWidth-this.width);var ab=0;var X=this.halfWidth-(this.width>>1);var Z=0;var Y=this.width*4;var ae=this.width*4;var V=this.width>>1;var U=this.height>>1;var T,aa,O,W,ag,ah;for(var P=0;P<U;P++){for(var N=0;N<V;N++){aa=ac[ab];O=Q[ab];ab++;W=(O+((O*103)>>8))-179;ag=((aa*88)>>8)-44+((O*183)>>8)-91;ah=(aa+((aa*198)>>8))-227;var L=M[S++];var K=M[S++];ad[Z]=L+W;ad[Z+1]=L-ag;ad[Z+2]=L+ah;ad[Z+4]=K+W;ad[Z+5]=K-ag;ad[Z+6]=K+ah;Z+=8;var J=M[R++];var I=M[R++];ad[Y]=J+W;ad[Y+1]=J-ag;ad[Y+2]=J+ah;ad[Y+4]=I+W;ad[Y+5]=I-ag;ad[Y+6]=I+ah;Y+=8}S+=af;R+=af;Z+=ae;Y+=ae;ab+=X}};n.prototype.renderFrame2D=function(){this.YCbCrToRGBA()};n.prototype.gl=null;n.prototype.program=null;n.prototype.YTexture=null;n.prototype.CBTexture=null;n.prototype.CRTexture=null;n.prototype.createTexture=function(J,I){var L=this.gl;var K=L.createTexture();L.bindTexture(L.TEXTURE_2D,K);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE);L.uniform1i(L.getUniformLocation(this.program,I),J);return K};n.prototype.compileShader=function(I,K){var L=this.gl;var J=L.createShader(I);L.shaderSource(J,K);L.compileShader(J);if(!L.getShaderParameter(J,L.COMPILE_STATUS)){throw new Error(L.getShaderInfoLog(J))}return J};n.prototype.initWebGL=function(){try{var K=this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl")}catch(J){return false}if(!K){return false}this.buffer=K.createBuffer();K.bindBuffer(K.ARRAY_BUFFER,this.buffer);K.bufferData(K.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),K.STATIC_DRAW);this.program=K.createProgram();K.attachShader(this.program,this.compileShader(K.VERTEX_SHADER,r));K.attachShader(this.program,this.compileShader(K.FRAGMENT_SHADER,i));K.linkProgram(this.program);if(!K.getProgramParameter(this.program,K.LINK_STATUS)){throw new Error(K.getProgramInfoLog(this.program))}K.useProgram(this.program);this.YTexture=this.createTexture(0,"YTexture");this.CBTexture=this.createTexture(1,"CBTexture");this.CRTexture=this.createTexture(2,"CRTexture");var I=K.getAttribLocation(this.program,"vertex");K.enableVertexAttribArray(I);K.vertexAttribPointer(I,2,K.FLOAT,false,0,0);this.loadingProgram=K.createProgram();K.attachShader(this.loadingProgram,this.compileShader(K.VERTEX_SHADER,r));K.attachShader(this.loadingProgram,this.compileShader(K.FRAGMENT_SHADER,C));K.linkProgram(this.loadingProgram);K.useProgram(this.loadingProgram);I=K.getAttribLocation(this.loadingProgram,"vertex");K.enableVertexAttribArray(I);K.vertexAttribPointer(I,2,K.FLOAT,false,0,0);return true};n.prototype.renderFrameGL=function(){var L=this.gl;var J=new Uint8Array(this.currentY.buffer),I=new Uint8Array(this.currentCr.buffer),K=new Uint8Array(this.currentCb.buffer);L.activeTexture(L.TEXTURE0);L.bindTexture(L.TEXTURE_2D,this.YTexture);L.texImage2D(L.TEXTURE_2D,0,L.LUMINANCE,this.codedWidth,this.height,0,L.LUMINANCE,L.UNSIGNED_BYTE,J);L.activeTexture(L.TEXTURE1);L.bindTexture(L.TEXTURE_2D,this.CBTexture);L.texImage2D(L.TEXTURE_2D,0,L.LUMINANCE,this.halfWidth,this.height/2,0,L.LUMINANCE,L.UNSIGNED_BYTE,I);L.activeTexture(L.TEXTURE2);L.bindTexture(L.TEXTURE_2D,this.CRTexture);L.texImage2D(L.TEXTURE_2D,0,L.LUMINANCE,this.halfWidth,this.height/2,0,L.LUMINANCE,L.UNSIGNED_BYTE,K);L.drawArrays(L.TRIANGLE_STRIP,0,4)};n.prototype.quantizerScale=0;n.prototype.sliceBegin=false;n.prototype.decodeSlice=function(I){this.sliceBegin=true;this.macroblockAddress=(I-1)*this.mbWidth-1;this.motionFwH=this.motionFwHPrev=0;this.motionFwV=this.motionFwVPrev=0;this.dcPredictorY=128;this.dcPredictorCr=128;this.dcPredictorCb=128;this.quantizerScale=this.buffer.getBits(5);while(this.buffer.getBits(1)){this.buffer.advance(8)}do{this.decodeMacroblock()}while(!this.buffer.nextBytesAreStartCode())};n.prototype.macroblockAddress=0;n.prototype.mbRow=0;n.prototype.mbCol=0;n.prototype.macroblockType=0;n.prototype.macroblockIntra=false;n.prototype.macroblockMotFw=false;n.prototype.motionFwH=0;n.prototype.motionFwV=0;n.prototype.motionFwHPrev=0;n.prototype.motionFwVPrev=0;n.prototype.decodeMacroblock=function(){var I=0,K=this.readCode(B);while(K==34){K=this.readCode(B)}while(K==35){I+=33;K=this.readCode(B)}I+=K;if(this.sliceBegin){this.sliceBegin=false;this.macroblockAddress+=I}else{if(this.macroblockAddress+I>=this.mbSize){return}if(I>1){this.dcPredictorY=128;this.dcPredictorCr=128;this.dcPredictorCb=128;if(this.pictureCodingType==a){this.motionFwH=this.motionFwHPrev=0;this.motionFwV=this.motionFwVPrev=0}}while(I>1){this.macroblockAddress++;this.mbRow=(this.macroblockAddress/this.mbWidth)|0;this.mbCol=this.macroblockAddress%this.mbWidth;this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb);I--}this.macroblockAddress++}this.mbRow=(this.macroblockAddress/this.mbWidth)|0;this.mbCol=this.macroblockAddress%this.mbWidth;this.macroblockType=this.readCode(v[this.pictureCodingType]);this.macroblockIntra=(this.macroblockType&1);this.macroblockMotFw=(this.macroblockType&8);if((this.macroblockType&16)!=0){this.quantizerScale=this.buffer.getBits(5)}if(this.macroblockIntra){this.motionFwH=this.motionFwHPrev=0;this.motionFwV=this.motionFwVPrev=0}else{this.dcPredictorY=128;this.dcPredictorCr=128;this.dcPredictorCb=128;this.decodeMotionVectors();this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb)}var L=((this.macroblockType&2)!=0)?this.readCode(E):(this.macroblockIntra?63:0);for(var M=0,J=32;M<6;M++){if((L&J)!=0){this.decodeBlock(M)}J>>=1}};n.prototype.decodeMotionVectors=function(){var J,K,I=0;if(this.macroblockMotFw){J=this.readCode(g);if((J!=0)&&(this.forwardF!=1)){I=this.buffer.getBits(this.forwardRSize);K=((Math.abs(J)-1)<<this.forwardRSize)+I+1;if(J<0){K=-K}}else{K=J}this.motionFwHPrev+=K;if(this.motionFwHPrev>(this.forwardF<<4)-1){this.motionFwHPrev-=this.forwardF<<5}else{if(this.motionFwHPrev<((-this.forwardF)<<4)){this.motionFwHPrev+=this.forwardF<<5}}this.motionFwH=this.motionFwHPrev;if(this.fullPelForward){this.motionFwH<<=1}J=this.readCode(g);if((J!=0)&&(this.forwardF!=1)){I=this.buffer.getBits(this.forwardRSize);K=((Math.abs(J)-1)<<this.forwardRSize)+I+1;if(J<0){K=-K}}else{K=J}this.motionFwVPrev+=K;if(this.motionFwVPrev>(this.forwardF<<4)-1){this.motionFwVPrev-=this.forwardF<<5}else{if(this.motionFwVPrev<((-this.forwardF)<<4)){this.motionFwVPrev+=this.forwardF<<5}}this.motionFwV=this.motionFwVPrev;if(this.fullPelForward){this.motionFwV<<=1}}else{if(this.pictureCodingType==a){this.motionFwH=this.motionFwHPrev=0;this.motionFwV=this.motionFwVPrev=0}}};n.prototype.copyMacroblock=function(ag,S,Q,aj,U){var ah,ae,ab,P,W,K,T,aa,Y;var O=this.currentY32;var I=this.currentCb32;var ai=this.currentCr32;ah=this.codedWidth;ae=ah-16;ab=ag>>1;P=S>>1;W=(ag&1)==1;K=(S&1)==1;T=((this.mbRow<<4)+P)*ah+(this.mbCol<<4)+ab;aa=(this.mbRow*ah+this.mbCol)<<2;Y=aa+(ah<<2);var N,M,X;if(W){if(K){while(aa<Y){N=Q[T]+Q[T+ah];T++;for(var Z=0;Z<4;Z++){M=Q[T]+Q[T+ah];T++;X=(((N+M+2)>>2)&255);N=Q[T]+Q[T+ah];T++;X|=(((N+M+2)<<6)&65280);M=Q[T]+Q[T+ah];T++;X|=(((N+M+2)<<14)&16711680);N=Q[T]+Q[T+ah];T++;X|=(((N+M+2)<<22)&4278190080);O[aa++]=X}aa+=ae>>2;T+=ae-1}}else{while(aa<Y){N=Q[T++];for(var Z=0;Z<4;Z++){M=Q[T++];X=(((N+M+1)>>1)&255);N=Q[T++];X|=(((N+M+1)<<7)&65280);M=Q[T++];X|=(((N+M+1)<<15)&16711680);N=Q[T++];X|=(((N+M+1)<<23)&4278190080);O[aa++]=X}aa+=ae>>2;T+=ae-1}}}else{if(K){while(aa<Y){for(var Z=0;Z<4;Z++){X=(((Q[T]+Q[T+ah]+1)>>1)&255);T++;X|=(((Q[T]+Q[T+ah]+1)<<7)&65280);T++;X|=(((Q[T]+Q[T+ah]+1)<<15)&16711680);T++;X|=(((Q[T]+Q[T+ah]+1)<<23)&4278190080);T++;O[aa++]=X}aa+=ae>>2;T+=ae}}else{while(aa<Y){for(var Z=0;Z<4;Z++){X=Q[T];T++;X|=Q[T]<<8;T++;X|=Q[T]<<16;T++;X|=Q[T]<<24;T++;O[aa++]=X}aa+=ae>>2;T+=ae}}}ah=this.halfWidth;ae=ah-8;ab=(ag/2)>>1;P=(S/2)>>1;W=((ag/2)&1)==1;K=((S/2)&1)==1;T=((this.mbRow<<3)+P)*ah+(this.mbCol<<3)+ab;aa=(this.mbRow*ah+this.mbCol)<<1;Y=aa+(ah<<1);var ad,ac,R;var L,J,af;if(W){if(K){while(aa<Y){ad=aj[T]+aj[T+ah];L=U[T]+U[T+ah];T++;for(var Z=0;Z<2;Z++){ac=aj[T]+aj[T+ah];J=U[T]+U[T+ah];T++;R=(((ad+ac+2)>>2)&255);af=(((L+J+2)>>2)&255);ad=aj[T]+aj[T+ah];L=U[T]+U[T+ah];T++;R|=(((ad+ac+2)<<6)&65280);af|=(((L+J+2)<<6)&65280);ac=aj[T]+aj[T+ah];J=U[T]+U[T+ah];T++;R|=(((ad+ac+2)<<14)&16711680);af|=(((L+J+2)<<14)&16711680);ad=aj[T]+aj[T+ah];L=U[T]+U[T+ah];T++;R|=(((ad+ac+2)<<22)&4278190080);af|=(((L+J+2)<<22)&4278190080);ai[aa]=R;I[aa]=af;aa++}aa+=ae>>2;T+=ae-1}}else{while(aa<Y){ad=aj[T];L=U[T];T++;for(var Z=0;Z<2;Z++){ac=aj[T];J=U[T++];R=(((ad+ac+1)>>1)&255);af=(((L+J+1)>>1)&255);ad=aj[T];L=U[T++];R|=(((ad+ac+1)<<7)&65280);af|=(((L+J+1)<<7)&65280);ac=aj[T];J=U[T++];R|=(((ad+ac+1)<<15)&16711680);af|=(((L+J+1)<<15)&16711680);ad=aj[T];L=U[T++];R|=(((ad+ac+1)<<23)&4278190080);af|=(((L+J+1)<<23)&4278190080);ai[aa]=R;I[aa]=af;aa++}aa+=ae>>2;T+=ae-1}}}else{if(K){while(aa<Y){for(var Z=0;Z<2;Z++){R=(((aj[T]+aj[T+ah]+1)>>1)&255);af=(((U[T]+U[T+ah]+1)>>1)&255);T++;R|=(((aj[T]+aj[T+ah]+1)<<7)&65280);af|=(((U[T]+U[T+ah]+1)<<7)&65280);T++;R|=(((aj[T]+aj[T+ah]+1)<<15)&16711680);af|=(((U[T]+U[T+ah]+1)<<15)&16711680);T++;R|=(((aj[T]+aj[T+ah]+1)<<23)&4278190080);af|=(((U[T]+U[T+ah]+1)<<23)&4278190080);T++;ai[aa]=R;I[aa]=af;aa++}aa+=ae>>2;T+=ae}}else{while(aa<Y){for(var Z=0;Z<2;Z++){R=aj[T];af=U[T];T++;R|=aj[T]<<8;af|=U[T]<<8;T++;R|=aj[T]<<16;af|=U[T]<<16;T++;R|=aj[T]<<24;af|=U[T]<<24;T++;ai[aa]=R;I[aa]=af;aa++}aa+=ae>>2;T+=ae}}}};n.prototype.dcPredictorY;n.prototype.dcPredictorCr;n.prototype.dcPredictorCb;n.prototype.blockData=null;n.prototype.decodeBlock=function(O){var K=0,S;if(this.macroblockIntra){var J,T;if(O<4){J=this.dcPredictorY;T=this.readCode(H)}else{J=(O==4?this.dcPredictorCr:this.dcPredictorCb);T=this.readCode(f)}if(T>0){var P=this.buffer.getBits(T);if((P&(1<<(T-1)))!=0){this.blockData[0]=J+P}else{this.blockData[0]=J+((-1<<T)|(P+1))}}else{this.blockData[0]=J}if(O<4){this.dcPredictorY=this.blockData[0]}else{if(O==4){this.dcPredictorCr=this.blockData[0]}else{this.dcPredictorCb=this.blockData[0]}}this.blockData[0]<<=(3+5);S=this.intraQuantMatrix;K=1}else{S=this.nonIntraQuantMatrix}var I=0;while(true){var L=0,R=this.readCode(s);if((R==1)&&(K>0)&&(this.buffer.getBits(1)==0)){break}if(R==65535){L=this.buffer.getBits(6);I=this.buffer.getBits(8);if(I==0){I=this.buffer.getBits(8)}else{if(I==128){I=this.buffer.getBits(8)-256}else{if(I>128){I=I-256}}}}else{L=R>>8;I=R&255;if(this.buffer.getBits(1)){I=-I}}K+=L;var N=G[K];K++;I<<=1;if(!this.macroblockIntra){I+=(I<0?-1:1)}I=(I*this.quantizerScale*S[N])>>4;if((I&1)==0){I-=I>0?1:-1}if(I>2047){I=2047}else{if(I<-2048){I=-2048}}this.blockData[N]=I*x[N]}var Q,M,U;if(O<4){Q=this.currentY;U=this.codedWidth-8;M=(this.mbRow*this.codedWidth+this.mbCol)<<4;if((O&1)!=0){M+=8}if((O&2)!=0){M+=this.codedWidth<<3}}else{Q=(O==4)?this.currentCb:this.currentCr;U=(this.codedWidth>>1)-8;M=((this.mbRow*this.codedWidth)<<2)+(this.mbCol<<3)}if(this.macroblockIntra){if(K==1){this.copyValueToDestination((this.blockData[0]+128)>>8,Q,M,U);this.blockData[0]=0}else{this.IDCT();this.copyBlockToDestination(this.blockData,Q,M,U);this.blockData.set(this.zeroBlockData)}}else{if(K==1){this.addValueToDestination((this.blockData[0]+128)>>8,Q,M,U);this.blockData[0]=0}else{this.IDCT();this.addBlockToDestination(this.blockData,Q,M,U);this.blockData.set(this.zeroBlockData)}}K=0};n.prototype.copyBlockToDestination=function(K,M,J,I){for(var L=0;L<64;L+=8,J+=I+8){M[J+0]=K[L+0];M[J+1]=K[L+1];M[J+2]=K[L+2];M[J+3]=K[L+3];M[J+4]=K[L+4];M[J+5]=K[L+5];M[J+6]=K[L+6];M[J+7]=K[L+7]}};n.prototype.addBlockToDestination=function(K,M,J,I){for(var L=0;L<64;L+=8,J+=I+8){M[J+0]+=K[L+0];M[J+1]+=K[L+1];M[J+2]+=K[L+2];M[J+3]+=K[L+3];M[J+4]+=K[L+4];M[J+5]+=K[L+5];M[J+6]+=K[L+6];M[J+7]+=K[L+7]}};n.prototype.copyValueToDestination=function(K,M,J,I){for(var L=0;L<64;L+=8,J+=I+8){M[J+0]=K;M[J+1]=K;M[J+2]=K;M[J+3]=K;M[J+4]=K;M[J+5]=K;M[J+6]=K;M[J+7]=K}};n.prototype.addValueToDestination=function(K,M,J,I){for(var L=0;L<64;L+=8,J+=I+8){M[J+0]+=K;M[J+1]+=K;M[J+2]+=K;M[J+3]+=K;M[J+4]+=K;M[J+5]+=K;M[J+6]+=K;M[J+7]+=K}};n.prototype.copyBlockToDestinationClamp=function(M,P,K,I){var O=0;for(var L=0;L<8;L++){for(var J=0;J<8;J++){var N=M[O++];P[K++]=N>255?255:(N<0?0:N)}K+=I}};n.prototype.addBlockToDestinationClamp=function(M,P,K,I){var O=0;for(var L=0;L<8;L++){for(var J=0;J<8;J++){var N=M[O++]+P[K];P[K++]=N>255?255:(N<0?0:N)}K+=I}};n.prototype.IDCT=function(){var S,R,Q,P,O,U,T,L,ab,aa,Z,Y,W,N,M,K,J,I,X,V=this.blockData;for(X=0;X<8;++X){S=V[4*8+X];R=V[2*8+X]+V[6*8+X];Q=V[5*8+X]-V[3*8+X];U=V[1*8+X]+V[7*8+X];T=V[3*8+X]+V[5*8+X];P=V[1*8+X]-V[7*8+X];O=U+T;L=V[0*8+X];W=((P*473-Q*196+128)>>8)-O;ab=W-(((U-T)*362+128)>>8);aa=L-S;Z=(((V[2*8+X]-V[6*8+X])*362+128)>>8)-R;Y=L+S;N=aa+Z;M=Y+R;K=aa-Z;J=Y-R;I=-ab-((Q*473+P*196+128)>>8);V[0*8+X]=O+M;V[1*8+X]=W+N;V[2*8+X]=K-ab;V[3*8+X]=J-I;V[4*8+X]=J+I;V[5*8+X]=ab+K;V[6*8+X]=N-W;V[7*8+X]=M-O}for(X=0;X<64;X+=8){S=V[4+X];R=V[2+X]+V[6+X];Q=V[5+X]-V[3+X];U=V[1+X]+V[7+X];T=V[3+X]+V[5+X];P=V[1+X]-V[7+X];O=U+T;L=V[0+X];W=((P*473-Q*196+128)>>8)-O;ab=W-(((U-T)*362+128)>>8);aa=L-S;Z=(((V[2+X]-V[6+X])*362+128)>>8)-R;Y=L+S;N=aa+Z;M=Y+R;K=aa-Z;J=Y-R;I=-ab-((Q*473+P*196+128)>>8);V[0+X]=(O+M+128)>>8;V[1+X]=(W+N+128)>>8;V[2+X]=(K-ab+128)>>8;V[3+X]=(J-I+128)>>8;V[4+X]=(J+I+128)>>8;V[5+X]=(ab+K+128)>>8;V[6+X]=(N-W+128)>>8;V[7+X]=(M-O+128)>>8}};var e="jsmp",D=1,q=[0,23.976,24,25,29.97,30,50,59.94,60,0,0,0,0,0,0,0],G=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),F=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),w=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),x=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),B=new Int16Array([1*3,2*3,0,3*3,4*3,0,0,0,1,5*3,6*3,0,7*3,8*3,0,9*3,10*3,0,11*3,12*3,0,0,0,3,0,0,2,13*3,14*3,0,15*3,16*3,0,0,0,5,0,0,4,17*3,18*3,0,19*3,20*3,0,0,0,7,0,0,6,21*3,22*3,0,23*3,24*3,0,25*3,26*3,0,27*3,28*3,0,-1,29*3,0,-1,30*3,0,31*3,32*3,0,33*3,34*3,0,35*3,36*3,0,37*3,38*3,0,0,0,9,0,0,8,39*3,40*3,0,41*3,42*3,0,43*3,44*3,0,45*3,46*3,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,47*3,-1,0,-1,48*3,0,49*3,50*3,0,51*3,52*3,0,53*3,54*3,0,55*3,56*3,0,57*3,58*3,0,59*3,60*3,0,61*3,-1,0,-1,62*3,0,63*3,64*3,0,65*3,66*3,0,67*3,68*3,0,69*3,70*3,0,71*3,72*3,0,73*3,74*3,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),j=new Int8Array([1*3,2*3,0,-1,3*3,0,0,0,1,0,0,17]),d=new Int8Array([1*3,2*3,0,3*3,4*3,0,0,0,10,5*3,6*3,0,0,0,2,7*3,8*3,0,0,0,8,9*3,10*3,0,11*3,12*3,0,-1,13*3,0,0,0,18,0,0,26,0,0,1,0,0,17]),o=new Int8Array([1*3,2*3,0,3*3,5*3,0,4*3,6*3,0,8*3,7*3,0,0,0,12,9*3,10*3,0,0,0,14,13*3,14*3,0,12*3,11*3,0,0,0,4,0,0,6,18*3,16*3,0,15*3,17*3,0,0,0,8,0,0,10,-1,19*3,0,0,0,1,20*3,21*3,0,0,0,30,0,0,17,0,0,22,0,0,26]),E=new Int16Array([2*3,1*3,0,3*3,6*3,0,4*3,5*3,0,8*3,11*3,0,12*3,13*3,0,9*3,7*3,0,10*3,14*3,0,20*3,19*3,0,18*3,16*3,0,23*3,17*3,0,27*3,25*3,0,21*3,28*3,0,15*3,22*3,0,24*3,26*3,0,0,0,60,35*3,40*3,0,44*3,48*3,0,38*3,36*3,0,42*3,47*3,0,29*3,31*3,0,39*3,32*3,0,0,0,32,45*3,46*3,0,33*3,41*3,0,43*3,34*3,0,0,0,4,30*3,37*3,0,0,0,8,0,0,16,0,0,44,50*3,56*3,0,0,0,28,0,0,52,0,0,62,61*3,59*3,0,52*3,60*3,0,0,0,1,55*3,54*3,0,0,0,61,0,0,56,57*3,58*3,0,0,0,2,0,0,40,51*3,62*3,0,0,0,48,64*3,63*3,0,49*3,53*3,0,0,0,20,0,0,12,80*3,83*3,0,0,0,63,77*3,75*3,0,65*3,73*3,0,84*3,66*3,0,0,0,24,0,0,36,0,0,3,69*3,87*3,0,81*3,79*3,0,68*3,71*3,0,70*3,78*3,0,67*3,76*3,0,72*3,74*3,0,86*3,85*3,0,88*3,82*3,0,-1,94*3,0,95*3,97*3,0,0,0,33,0,0,9,106*3,110*3,0,102*3,116*3,0,0,0,5,0,0,10,93*3,89*3,0,0,0,6,0,0,18,0,0,17,0,0,34,113*3,119*3,0,103*3,104*3,0,90*3,92*3,0,109*3,107*3,0,117*3,118*3,0,101*3,99*3,0,98*3,96*3,0,100*3,91*3,0,114*3,115*3,0,105*3,108*3,0,112*3,111*3,0,121*3,125*3,0,0,0,41,0,0,14,0,0,21,124*3,122*3,0,120*3,123*3,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),g=new Int16Array([1*3,2*3,0,4*3,3*3,0,0,0,0,6*3,5*3,0,8*3,7*3,0,0,0,-1,0,0,1,9*3,10*3,0,12*3,11*3,0,0,0,2,0,0,-2,14*3,15*3,0,16*3,13*3,0,20*3,18*3,0,0,0,3,0,0,-3,17*3,19*3,0,-1,23*3,0,27*3,25*3,0,26*3,21*3,0,24*3,22*3,0,32*3,28*3,0,29*3,31*3,0,-1,33*3,0,36*3,35*3,0,0,0,-4,30*3,34*3,0,0,0,4,0,0,-7,0,0,5,37*3,41*3,0,0,0,-5,0,0,7,38*3,40*3,0,42*3,39*3,0,0,0,-6,0,0,6,51*3,54*3,0,50*3,49*3,0,45*3,46*3,0,52*3,47*3,0,43*3,53*3,0,44*3,48*3,0,0,0,10,0,0,9,0,0,8,0,0,-8,57*3,66*3,0,0,0,-9,60*3,64*3,0,56*3,61*3,0,55*3,62*3,0,58*3,63*3,0,0,0,-10,59*3,65*3,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),H=new Int8Array([2*3,1*3,0,6*3,5*3,0,3*3,4*3,0,0,0,1,0,0,2,9*3,8*3,0,7*3,10*3,0,0,0,0,12*3,11*3,0,0,0,4,0,0,3,13*3,14*3,0,0,0,5,0,0,6,16*3,15*3,0,17*3,-1,0,0,0,7,0,0,8]),f=new Int8Array([2*3,1*3,0,4*3,3*3,0,6*3,5*3,0,8*3,7*3,0,0,0,2,0,0,1,0,0,0,10*3,9*3,0,0,0,3,12*3,11*3,0,0,0,4,14*3,13*3,0,0,0,5,16*3,15*3,0,0,0,6,17*3,-1,0,0,0,7,0,0,8]),s=new Int32Array([1*3,2*3,0,4*3,3*3,0,0,0,1,7*3,8*3,0,6*3,5*3,0,13*3,9*3,0,11*3,10*3,0,14*3,12*3,0,0,0,257,20*3,22*3,0,18*3,21*3,0,16*3,19*3,0,0,0,513,17*3,15*3,0,0,0,2,0,0,3,27*3,25*3,0,29*3,31*3,0,24*3,26*3,0,32*3,30*3,0,0,0,1025,23*3,28*3,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,37*3,36*3,0,0,0,1281,35*3,34*3,0,39*3,38*3,0,33*3,42*3,0,40*3,41*3,0,52*3,50*3,0,54*3,53*3,0,48*3,49*3,0,43*3,45*3,0,46*3,44*3,0,0,0,2049,0,0,4,0,0,514,0,0,2305,51*3,47*3,0,55*3,57*3,0,60*3,56*3,0,59*3,58*3,0,61*3,62*3,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,76*3,75*3,0,67*3,70*3,0,73*3,71*3,0,78*3,74*3,0,72*3,77*3,0,69*3,64*3,0,68*3,63*3,0,66*3,65*3,0,81*3,87*3,0,91*3,80*3,0,82*3,79*3,0,83*3,86*3,0,93*3,92*3,0,84*3,85*3,0,90*3,94*3,0,88*3,89*3,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,105*3,107*3,0,111*3,114*3,0,104*3,97*3,0,125*3,119*3,0,96*3,98*3,0,-1,123*3,0,95*3,101*3,0,106*3,121*3,0,99*3,102*3,0,113*3,103*3,0,112*3,116*3,0,110*3,100*3,0,124*3,115*3,0,117*3,122*3,0,109*3,118*3,0,120*3,108*3,0,127*3,136*3,0,139*3,140*3,0,130*3,126*3,0,145*3,146*3,0,128*3,129*3,0,0,0,2050,132*3,134*3,0,155*3,154*3,0,0,0,8,137*3,133*3,0,143*3,144*3,0,151*3,138*3,0,142*3,141*3,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,148*3,152*3,0,0,0,1027,153*3,150*3,0,0,0,261,131*3,135*3,0,0,0,516,149*3,147*3,0,172*3,173*3,0,162*3,158*3,0,170*3,161*3,0,168*3,166*3,0,157*3,179*3,0,169*3,167*3,0,174*3,171*3,0,178*3,177*3,0,156*3,159*3,0,164*3,165*3,0,183*3,182*3,0,175*3,176*3,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,180*3,181*3,0,160*3,163*3,0,196*3,199*3,0,0,0,27,203*3,185*3,0,202*3,201*3,0,0,0,19,0,0,22,197*3,207*3,0,0,0,18,191*3,192*3,0,188*3,190*3,0,0,0,20,184*3,194*3,0,0,0,21,186*3,193*3,0,0,0,23,204*3,198*3,0,0,0,25,0,0,24,200*3,205*3,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,189*3,206*3,0,187*3,195*3,0,218*3,211*3,0,0,0,37,215*3,216*3,0,0,0,36,210*3,212*3,0,0,0,34,213*3,209*3,0,221*3,222*3,0,219*3,208*3,0,217*3,214*3,0,223*3,220*3,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),h=1,a=2,m=3,l=4,u=179,y=1,b=175,t=0,c=181,z=178,i=["precision mediump float;","uniform sampler2D YTexture;","uniform sampler2D CBTexture;","uniform sampler2D CRTexture;","varying vec2 texCoord;","void main() {","float y = texture2D(YTexture, texCoord).r;","float cr = texture2D(CBTexture, texCoord).r - 0.5;","float cb = texture2D(CRTexture, texCoord).r - 0.5;","gl_FragColor = vec4(","y + 1.4 * cr,","y + -0.343 * cb - 0.711 * cr,","y + 1.765 * cb,","1.0",");","}"].join("\n"),C=["precision mediump float;","uniform float loaded;","varying vec2 texCoord;","void main() {","float c = ceil(loaded-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),r=["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n");var v=[null,j,d,o];var A=function(I){this.bytes=new Uint8Array(I);this.length=this.bytes.length;this.writePos=this.bytes.length;this.index=0};A.NOT_FOUND=-1;A.prototype.findNextMPEGStartCode=function(){for(var I=(this.index+7>>3);I<this.writePos;I++){if(this.bytes[I]==0&&this.bytes[I+1]==0&&this.bytes[I+2]==1){this.index=(I+4)<<3;return this.bytes[I+3]}}this.index=(this.writePos<<3);return A.NOT_FOUND};A.prototype.nextBytesAreStartCode=function(){var I=(this.index+7>>3);return(I>=this.writePos||(this.bytes[I]==0&&this.bytes[I+1]==0&&this.bytes[I+2]==1))};A.prototype.nextBits=function(L){var K=this.index>>3,N=(8-this.index%8);if(N>=L){return(this.bytes[K]>>(N-L))&(255>>(8-L))}var J=(this.index+L)%8,I=(this.index+L-1)>>3,M=this.bytes[K]&(255>>(8-N));for(K++;K<I;K++){M<<=8;M|=this.bytes[K]}if(J>0){M<<=J;M|=(this.bytes[K]>>(8-J))}else{M<<=8;M|=this.bytes[K]}return M};A.prototype.getBits=function(I){var J=this.nextBits(I);this.index+=I;return J};A.prototype.advance=function(I){return(this.index+=I)};A.prototype.rewind=function(I){return(this.index-=I)}})(window);function Resampler(c,e,b,d,a){this.fromSampleRate=c;this.toSampleRate=e;this.channels=b|0;this.outputBufferSize=d;this.noReturn=!!a;this.initialize()}Resampler.prototype.initialize=function(){if(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0){if(this.fromSampleRate==this.toSampleRate){this.resampler=this.bypassResampler;this.ratioWeight=1}else{this.ratioWeight=this.fromSampleRate/this.toSampleRate;if(this.fromSampleRate<this.toSampleRate){this.compileLinearInterpolationFunction();this.lastWeight=1}else{this.compileMultiTapFunction();this.tailExists=false;this.lastWeight=0}this.initializeBuffers()}}else{throw (new Error("Invalid settings specified for the resampler."))}};Resampler.prototype.compileLinearInterpolationFunction=function(){var a="var bufferLength = buffer.length;	var outLength = this.outputBufferSize;	if ((bufferLength % "+this.channels+") == 0) {		if (bufferLength > 0) {			var weight = this.lastWeight;			var firstWeight = 0;			var secondWeight = 0;			var sourceOffset = 0;			var outputOffset = 0;			var outputBuffer = this.outputBuffer;			for (; weight < 1; weight += "+this.ratioWeight+") {				secondWeight = weight % 1;				firstWeight = 1 - secondWeight;";for(var b=0;b<this.channels;++b){a+="outputBuffer[outputOffset++] = (this.lastOutput["+b+"] * firstWeight) + (buffer["+b+"] * secondWeight);"}a+="}			weight -= 1;			for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {				secondWeight = weight % 1;				firstWeight = 1 - secondWeight;";for(var b=0;b<this.channels;++b){a+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+((b>0)?(" + "+b):"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+b)+"] * secondWeight);"}a+="weight += "+this.ratioWeight+";				sourceOffset = Math.floor(weight) * "+this.channels+";			}";for(var b=0;b<this.channels;++b){a+="this.lastOutput["+b+"] = buffer[sourceOffset++];"}a+='this.lastWeight = weight % 1;			return this.bufferSlice(outputOffset);		}		else {			return (this.noReturn) ? 0 : [];		}	}	else {		throw(new Error("Buffer was of incorrect sample length."));	}';this.resampler=Function("buffer",a)};Resampler.prototype.compileMultiTapFunction=function(){var a="var bufferLength = buffer.length;	var outLength = this.outputBufferSize;	if ((bufferLength % "+this.channels+") == 0) {		if (bufferLength > 0) {			var weight = 0;";for(var b=0;b<this.channels;++b){a+="var output"+b+" = 0;"}a+="var actualPosition = 0;			var amountToNext = 0;			var alreadyProcessedTail = !this.tailExists;			this.tailExists = false;			var outputBuffer = this.outputBuffer;			var outputOffset = 0;			var currentPosition = 0;			do {				if (alreadyProcessedTail) {					weight = "+this.ratioWeight+";";for(b=0;b<this.channels;++b){a+="output"+b+" = 0;"}a+="}				else {					weight = this.lastWeight;";for(b=0;b<this.channels;++b){a+="output"+b+" = this.lastOutput["+b+"];"}a+="alreadyProcessedTail = true;				}				while (weight > 0 && actualPosition < bufferLength) {					amountToNext = 1 + actualPosition - currentPosition;					if (weight >= amountToNext) {";for(b=0;b<this.channels;++b){a+="output"+b+" += buffer[actualPosition++] * amountToNext;"}a+="currentPosition = actualPosition;						weight -= amountToNext;					}					else {";for(b=0;b<this.channels;++b){a+="output"+b+" += buffer[actualPosition"+((b>0)?(" + "+b):"")+"] * weight;"}a+="currentPosition += weight;						weight = 0;						break;					}				}				if (weight <= 0) {";for(b=0;b<this.channels;++b){a+="outputBuffer[outputOffset++] = output"+b+" / "+this.ratioWeight+";"}a+="}				else {					this.lastWeight = weight;";for(b=0;b<this.channels;++b){a+="this.lastOutput["+b+"] = output"+b+";"}a+='this.tailExists = true;					break;				}			} while (actualPosition < bufferLength && outputOffset < outLength);			return this.bufferSlice(outputOffset);		}		else {			return (this.noReturn) ? 0 : [];		}	}	else {		throw(new Error("Buffer was of incorrect sample length."));	}';this.resampler=Function("buffer",a)};Resampler.prototype.bypassResampler=function(a){if(this.noReturn){this.outputBuffer=a;return a.length}else{return a}};Resampler.prototype.bufferSlice=function(a){if(this.noReturn){return a}else{try{return this.outputBuffer.subarray(0,a)}catch(b){try{this.outputBuffer.length=a;return this.outputBuffer}catch(b){return this.outputBuffer.slice(0,a)}}}};Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize);this.lastOutput=new Float32Array(this.channels)}catch(a){this.outputBuffer=[];this.lastOutput=[]}};